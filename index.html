<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Split Image with Grid and Excel Answer</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0;
      max-width: fit-content;
      margin-top: 20px;
    }

    .grid img {
      width: 100%;
      height: auto;
      display: block;
      object-fit: cover;
      margin: 0;
      padding: 0;
      border: none;
      visibility: hidden;
      image-rendering: pixelated;
    }

    .grid .visible {
      visibility: visible;
    }

    .container {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }

    #defaultImage {
      display: none;
      width: 40%;
      height: auto;
      object-fit: contain;
    }

    .flying-object {
      position: fixed;
      top: 20%;
      left: -150px;
      width: 120px;
      height: auto;
      z-index: 9999;
      pointer-events: none;
      animation: flyAcross 12s linear infinite;
    }

    @keyframes flyAcross {
      0% { transform: translateX(0); }
      100% { transform: translateX(120vw); }
    }

    .flying-tank {
      position: fixed;
      bottom: 0;
      right: -200px;
      width: 150px;
      height: auto;
      z-index: 9999;
      pointer-events: none;
      animation: tankMoveLeft 15s linear infinite;
    }
    
    @keyframes tankMoveLeft {
      0% { transform: translateX(0); }
      100% { transform: translateX(-120vw); }
    }
    

    .tank-wrapper {
      position: relative; /* Äáº£m báº£o tank-wrapper cÃ³ position: relative */
      bottom: 50px;
      left: 100px;
      width: 150px; /* KÃ­ch thÆ°á»›c má»›i cá»§a tank-wrapper */
      height: auto;
      z-index: 1000;
      display: flex;
      align-items: center; /* CÄƒn chá»‰nh pháº§n tá»­ con theo chiá»u dá»c */
    }
    
    .fire {
      position: absolute;
      width: 20px;
      height: 20px;
      background: radial-gradient(circle, orange, red, transparent);
      border-radius: 50%;
      left: -10px;  /* Äáº·t lá»­a cÃ¡ch xe tÄƒng 10px */
      top: 50%;
      transform: translateY(-50%);
      animation: flame 0.2s infinite alternate;
      opacity: 0.8;
      pointer-events: none;
      z-index: 999;  /* Äáº£m báº£o lá»­a luÃ´n náº±m trÃªn xe tÄƒng */
    }
    
    
    @keyframes flame {
      0% {
        transform: translateY(-50%) scale(1);
        opacity: 0.8;
      }
      100% {
        transform: translateY(-50%) scale(1.4);
        opacity: 0.4;
      }
    }
    

    .flying-doclap {
      position: fixed;
      bottom: 20px;
      left: 20px;
      width: 150px;
      height: auto;
      z-index: 1000;
      pointer-events: none;
    }
    .doclap-wrapper {
      position: fixed;
      bottom: 20px;
      left: 20px;
      width: 150px;
      height: auto;
      z-index: 1000;
      pointer-events: none;
    }
    
    .flying-doclap-img {
      width: 100%;
      height: auto;
      display: none;
    }
    
    #victoryMessage {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%) scale(0.5);
      font-size: 22px;
      font-weight: bold;
      color: red;
      text-shadow: 2px 2px 5px yellow;
      opacity: 0;
      transition: all 0.5s ease;
      white-space: nowrap;
    }
    
    #victoryMessage.show {
      opacity: 1;
      transform: translateX(-50%) scale(1.2);
    }
    .flying-object {
      animation: flyAcross 10s linear forwards; /* bay 1 láº§n rá»“i dá»«ng */
    }
    
    .flying-tank {
      animation: tankMoveLeft 15s linear forwards;
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 999;
      padding-top: 100px;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.5);
    }
    
    .modal-content {
      margin: auto;
      background-color: #fff;
      padding: 20px;
      width: 60%;
      border-radius: 8px;
      position: relative;
      box-shadow: 0 5px 10px rgba(0,0,0,0.3);
    }
    
    .close {
      color: #aaa;
      font-size: 28px;
      font-weight: bold;
      position: absolute;
      top: 10px; right: 20px;
      cursor: pointer;
    }
    
    button#continueUpload {
      margin-top: 15px;
      padding: 10px 20px;
      background-color: #4caf50;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .visible {
      opacity: 0;
      transform: scale(0.8);
      animation: popIn 0.4s ease-out forwards;
    }
    
    @keyframes popIn {
      to {
        opacity: 1;
        transform: scale(1);
      }
    }
    #congrats {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 3em;
      background: rgba(255, 255, 255, 0.9);
      padding: 30px 50px;
      border-radius: 20px;
      z-index: 9999;
      animation: pulse 1s infinite;
    }
    
    @keyframes pulse {
      0% { transform: translate(-50%, -50%) scale(1); }
      50% { transform: translate(-50%, -50%) scale(1.05); }
      100% { transform: translate(-50%, -50%) scale(1); }
    }
    
    .hidden {
      display: none;
    }
    @keyframes flyZigzag {
      0% {
        transform: translate(0, 0);
      }
      20% {
        transform: translate(20vw, -20px);
      }
      40% {
        transform: translate(40vw, 20px);
      }
      60% {
        transform: translate(60vw, -20px);
      }
      80% {
        transform: translate(80vw, 20px);
      }
      100% {
        transform: translate(100vw, 0);
      }
    }
    
    .flying-object {
      position: fixed;
      width: 120px;
      z-index: 999;
      pointer-events: none;
    }
    @keyframes flyAcross {
      0% {
        left: -10%; /* Vá»‹ trÃ­ ban Ä‘áº§u bÃªn ngoÃ i mÃ n hÃ¬nh trÃ¡i */
      }
      100% {
        left: 110%; /* Vá»‹ trÃ­ cuá»‘i cÃ¹ng ngoÃ i mÃ n hÃ¬nh pháº£i */
      }
    }
    
    .flying-object {
      position: fixed; /* Äáº£m báº£o mÃ¡y bay cá»‘ Ä‘á»‹nh trong viewport */
      top: 20%; /* Äáº·t vá»‹ trÃ­ báº¯t Ä‘áº§u cá»§a mÃ¡y bay */
      width: 50px; /* Äáº·t kÃ­ch thÆ°á»›c cá»§a mÃ¡y bay */
      height: auto;
      z-index: 10; /* Äáº£m báº£o mÃ¡y bay xuáº¥t hiá»‡n phÃ­a trÃªn cÃ¡c pháº§n tá»­ khÃ¡c */
    }
    
    .form-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 50px;
    }
    input[type="text"] {
      padding: 10px;
      font-size: 16px;
      margin-bottom: 10px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <img id="defaultImage" src="./44.jpg" crossOrigin="anonymous">
  <div id="notification" style="display: none; color: green; font-size: 16px; margin-top: 10px;"></div>
  
<h3>Upload Excel chá»©a Ä‘Ã¡p Ã¡n (vÃ­ dá»¥: "1A 10C 25B"):</h3>
<!-- Form nháº­p tÃªn -->
<!-- Form nháº­p tÃªn -->
<!-- Form nháº­p tÃªn -->
<!-- Form nháº­p tÃªn -->
<form id="nameForm">
  <input type="text" id="username" placeholder="Nháº­p tÃªn cá»§a báº¡n" required>
  <button type="submit">LÆ°u tÃªn</button>
</form>

<!-- Modal lÆ°u Ã½ -->
<div id="noteModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h3>ğŸ“Œ LÆ°u Ã½ khi nháº­p file Excel</h3>
    <ul>
      <li>ğŸ“ ÄÃ¡p Ã¡n theo Ä‘á»‹nh dáº¡ng: <strong>1A, 2B, 3C..má»—i Ä‘Ã¡p Ã¡n nÃªn xuá»‘ng dÃ²ng</strong></li>
      <li>ğŸ“ Chá»‰ dÃ¹ng <strong>cá»™t Ä‘áº§u tiÃªn</strong> Ä‘á»ƒ nháº­p</li>
      <li>â›” Khi Ã¢m thanh bá»‹ lá»—i hÃ£y loard láº¡i trang</li>
    </ul>
  </div>
</div>





<!-- Input táº£i lÃªn file Excel -->
<input type="file" id="uploadExcel" accept=".xlsx" style="display:block"><br><br>

<!-- ThÃ´ng bÃ¡o yÃªu cáº§u nháº­p tÃªn -->
<script>
  // HÃ m kiá»ƒm tra náº¿u tÃªn Ä‘Ã£ Ä‘Æ°á»£c lÆ°u trong sessionStorage
  function checkStoredData() {
    const storedUsername = sessionStorage.getItem('username');
    const uploadExcelElement = document.getElementById('uploadExcel');
    const nameFormElement = document.getElementById('nameForm');
    const notification = document.getElementById('notification');
    
    // Kiá»ƒm tra xem tÃªn Ä‘Ã£ Ä‘Æ°á»£c lÆ°u trong sessionStorage
    if (storedUsername) {
      // Náº¿u Ä‘Ã£ cÃ³ tÃªn, áº©n form nháº­p tÃªn vÃ  hiá»ƒn thá»‹ input táº£i lÃªn file
      nameFormElement.style.display = 'none'; // áº¨n form nháº­p tÃªn
      uploadExcelElement.style.display = 'block'; // Hiá»ƒn thá»‹ input táº£i lÃªn file
      notification.style.display = 'none'; // áº¨n thÃ´ng bÃ¡o yÃªu cáº§u nháº­p tÃªn
    } else {
      // Náº¿u chÆ°a cÃ³ tÃªn, chá»‰ hiá»ƒn thá»‹ form nháº­p tÃªn vÃ  áº©n input táº£i lÃªn file
      uploadExcelElement.style.display = 'none'; // áº¨n input táº£i lÃªn file
      notification.style.display = 'block'; // Hiá»ƒn thá»‹ thÃ´ng bÃ¡o yÃªu cáº§u nháº­p tÃªn
      nameFormElement.style.display = 'block'; // Hiá»ƒn thá»‹ form nháº­p tÃªn
    }
  }

  // Äáº£m báº£o kiá»ƒm tra dá»¯ liá»‡u khi DOM Ä‘Ã£ sáºµn sÃ ng
  document.addEventListener('DOMContentLoaded', function() {
    checkStoredData(); // Kiá»ƒm tra vÃ  cáº­p nháº­t giao diá»‡n sau khi trang táº£i
  });

  // Xá»­ lÃ½ form submit
  document.getElementById('nameForm').addEventListener('submit', function(event) {
    event.preventDefault(); // Ngá»«ng hÃ nh Ä‘á»™ng máº·c Ä‘á»‹nh cá»§a form (reload trang)

    const username = document.getElementById('username').value.trim();
    
    if (username) {
      // LÆ°u tÃªn vÃ o sessionStorage
      sessionStorage.setItem('username', username); // LÆ°u tÃªn vÃ o sessionStorage
      
      // ThÃªm thÃ´ng bÃ¡o thÃ nh cÃ´ng
      const notificationElement = document.getElementById('notification');
      notificationElement.innerHTML = 'ChÃ o má»«ng báº¡n, ' + username; // ThÃªm tÃªn vÃ o thÃ´ng bÃ¡o
      notificationElement.style.color = 'green'; // Äá»•i mÃ u thÃ´ng bÃ¡o thÃ nh xanh
      
      // Kiá»ƒm tra láº¡i vÃ  cáº­p nháº­t giao diá»‡n
      checkStoredData(); // Gá»i láº¡i Ä‘á»ƒ cáº­p nháº­t giao diá»‡n
    } else {
      // Náº¿u chÆ°a nháº­p tÃªn, hiá»ƒn thá»‹ thÃ´ng bÃ¡o yÃªu cáº§u nháº­p tÃªn
      const notificationElement = document.getElementById('notification');
      notificationElement.style.display = 'block'; // Hiá»ƒn thá»‹ thÃ´ng bÃ¡o
    }
  });
</script>





<img id="defaultImage" src="./44.jpg" crossOrigin="anonymous">

<div id="notification" style="display: none; color: green; font-size: 16px; margin-top: 10px;"></div>


<button id="openNoteModal" style="
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1000;
  background-color: #28a745;
  color: white;
  padding: 10px 16px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
">
  ğŸ“Œ HÆ°á»›ng dáº«n nháº­p Excel
</button>

<div class="container">
  <div class="grid" id="result"></div>
</div>
<div id="congrats" class="hidden">ğŸ‰ ChÃºc má»«ng báº¡n Ä‘Ã£ hoÃ n thÃ nh! ğŸ‰</div>

<!-- SheetJS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<!-- Fireworks -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script>
  function randomizeImage() {
    const imageNames = ['44.jpg', '55.jpg', '66.jpg', '77.jpg', '88.jpg', '99.jpg','10.jpg'];
    const randomIndex = Math.floor(Math.random() * imageNames.length);
    const imgElement = document.getElementById('defaultImage');

    imgElement.src = `./${imageNames[randomIndex]}`;

    // LÆ°u áº£nh vÃ o sessionStorage
    sessionStorage.setItem('lastImage', imageNames[randomIndex]);

    // Hiá»ƒn thá»‹ thÃ´ng bÃ¡o
    const notification = document.getElementById('notification');
    //notification.textContent = `ÄÃ£ thay Ä‘á»•i áº£nh thÃ nh: ${imageNames[randomIndex]}`; -->
    notification.style.display = 'block';
  }

  // HÃ m kiá»ƒm tra náº¿u cÃ³ áº£nh vÃ  tÃªn Ä‘Ã£ lÆ°u trong sessionStorage
  function checkStoredData() {
    const storedUsername = sessionStorage.getItem('username');
    const storedImage = sessionStorage.getItem('lastImage');

    // Kiá»ƒm tra tÃªn Ä‘Ã£ lÆ°u
    if (storedUsername) {
      // Náº¿u Ä‘Ã£ cÃ³ tÃªn, áº©n form vÃ  hiá»ƒn thá»‹ thÃ´ng bÃ¡o
      const form = document.getElementById('nameForm');
      form.style.display = 'none'; // áº¨n form

      // Hiá»ƒn thá»‹ thÃ´ng bÃ¡o vá» tÃªn Ä‘Ã£ lÆ°u
      const notification = document.getElementById('notification');
      notification.textContent = `ChÃ o láº¡i ${storedUsername}!`;
      notification.style.display = 'block'; // Hiá»ƒn thá»‹ thÃ´ng bÃ¡o
    }

    // Náº¿u áº£nh Ä‘Ã£ lÆ°u, hiá»ƒn thá»‹ láº¡i áº£nh Ä‘Ã³
    if (storedImage) {
      const imgElement = document.getElementById('defaultImage');
      imgElement.src = `./${storedImage}`; // Set láº¡i áº£nh Ä‘Ã£ lÆ°u
    } else {
      randomizeImage(); // Náº¿u chÆ°a cÃ³ áº£nh, random áº£nh má»›i
    }
  }

  // Gá»i hÃ m checkStoredData khi trang táº£i
  window.onload = checkStoredData;

  // Xá»­ lÃ½ form submit
  document.getElementById('nameForm').addEventListener('submit', function(event) {
    event.preventDefault(); // Ngá»«ng hÃ nh Ä‘á»™ng máº·c Ä‘á»‹nh cá»§a form (reload trang)

    const username = document.getElementById('username').value.trim();
    
    if (username) {
      sessionStorage.setItem('username', username); // LÆ°u tÃªn vÃ o sessionStorage
      alert(`TÃªn cá»§a báº¡n (${username}) Ä‘Ã£ Ä‘Æ°á»£c lÆ°u!`);
      // áº¨n form vÃ  thÃ´ng bÃ¡o sau khi nháº­p xong
      const form = document.getElementById('nameForm');
      const notification = document.getElementById('notification');
      form.style.display = 'none'; // áº¨n form
      notification.textContent = `TÃªn cá»§a báº¡n ${username} Ä‘Ã£ Ä‘Æ°á»£c lÆ°u!`;
      notification.style.display = 'block'; // Hiá»ƒn thá»‹ thÃ´ng bÃ¡o thÃ nh cÃ´ng
    }
  });
  document.addEventListener("DOMContentLoaded", function () {
    const answerMap = new Map();
    const soSanh = [
    "1A", "2C", "3A", "4C", "5C", "6C", "7B", "8B", "9C", "10B",
    "11B", "12B", "13B", "14C", "15A", "16C", "17C", "18C", "19C", "20C",
    "21C", "22A", "23C", "24B", "25C", "26B", "27C", "28B", "29C", "30A",
    "31C", "32B", "33C"
  ];
  
    const uploadInput = document.getElementById('uploadExcel');
    const noteModal = document.getElementById('noteModal');
    const closeModal = document.querySelector('.close');
    const continueBtn = document.getElementById('continueUpload');
    
    
    // ÄÃ³ng modal
    closeModal.onclick = () => {
      noteModal.style.display = 'none';
      uploadInput.value = ''; // Reset input náº¿u Ä‘Ã³ng
    };
    openNoteModal.onclick = () => {
      noteModal.style.display = 'block';
    };
  
    // ÄÃ³ng modal khi nháº¥n dáº¥u X
    closeModal.onclick = () => {
      noteModal.style.display = 'none';
    };
  
    // ÄÃ³ng modal khi nháº¥n ra ngoÃ i vÃ¹ng modal-content
    window.onclick = (event) => {
      if (event.target === noteModal) {
        noteModal.style.display = 'none';
      }
    };
    // Tiáº¿p tá»¥c xá»­ lÃ½ sau khi nháº¥n "TÃ´i Ä‘Ã£ hiá»ƒu"
 
    
    let isTankPassing = false;

    document.getElementById('uploadExcel').addEventListener('change', function (e) {
      const file = e.target.files[0];
      const reader = new FileReader();

      reader.onload = function (event) {
        const data = new Uint8Array(event.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const sheetName = workbook.SheetNames[0];
        const worksheet = workbook.Sheets[sheetName];
        const json = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

        const answerString = json.map(row => row[0])
          .filter(cell => !!cell)
          .join(' ')
          .replace(/\s+/g, '')
          .toUpperCase();

        const regex = /(\d{1,2}|100)[A-D]/g;
        const matches = answerString.match(regex);

        answerMap.clear();
        function animate() {
          checkTankCrossing();
          requestAnimationFrame(animate);
        }
      
        animate();
        if (matches) {
          matches.forEach(ans => {
            const number = parseInt(ans.match(/\d+/)[0]);
            const choice = ans.match(/[A-D]/)[0];
            answerMap.set(number, choice);
          });

          const img = document.getElementById('defaultImage');
          if (img.complete) {
            processImage(img);
          } else {
            img.onload = () => processImage(img);
          }
        } else {
          document.getElementById('result').innerHTML = 'KhÃ´ng tÃ¬m tháº¥y Ä‘Ã¡p Ã¡n phÃ¹ há»£p.';
        }
      };

      reader.readAsArrayBuffer(file);
    });



   // Biáº¿n toÃ n cá»¥c Ä‘á»ƒ lÆ°u sá»‘ cÃ¢u tráº£ lá»i Ä‘Ãºng
   let correctAnswers = 0;

   function processImage(img) {
     const rows = 11;
     const cols = 3;
     const tileWidth = img.naturalWidth / cols;
     const tileHeight = img.naturalHeight / rows;
   
     const result = document.getElementById('result');
     result.innerHTML = '';
   
     let count = 1;
     let wrongAnswers = [];
   
     correctAnswers = 0; // Reset má»—i láº§n xá»­ lÃ½
   
     for (let y = 0; y < rows; y++) {
       for (let x = 0; x < cols; x++) {
         const canvas = document.createElement('canvas');
         canvas.width = tileWidth;
         canvas.height = tileHeight;
         const ctx = canvas.getContext('2d');
   
         ctx.drawImage(img, x * tileWidth, y * tileHeight, tileWidth, tileHeight, 0, 0, tileWidth, tileHeight);
   
         const imgElement = document.createElement('img');
         imgElement.src = canvas.toDataURL();
   
         const container = document.createElement('div');
         container.appendChild(imgElement);
   
         const currentAnswer = answerMap.get(count);
         const fullAnswer = `${count}${currentAnswer}`;
   
         if (currentAnswer && soSanh.includes(fullAnswer)) {
           imgElement.classList.add('visible');
           correctAnswers++;
         } else {
           wrongAnswers.push(count);
         }
   
         result.appendChild(container);
         count++;
       }
     }
   
     // Kiá»ƒm tra káº¿t quáº£
     if (correctAnswers === 33) {
       alert('ğŸ‰ ChÃºc má»«ng! Báº¡n Ä‘Ã£ hoÃ n thÃ nh thá»­ thÃ¡ch!');
       playVictoryMusic();
       hienDocLap();
       startEffects();
     } else if (correctAnswers > 0 && correctAnswers < 33) {
      anDocLap();
    
      if (wrongAnswers.length > 0) {
        alert(`âŒ Báº¡n Ä‘Ã£ sai cÃ¡c cÃ¢u: ${wrongAnswers.join(', ')}`);
      }
    }
   
     // HÃ m bá»• sung cho kiá»ƒm tra tá»«ng cÃ¢u
     function checkAnswer(isCorrect) {
       if (isCorrect && correctAnswers < 33) {
         stopAllEffects();
       }
     }


     function startEffects() {
      // Hiá»‡n báº£ng chÃºc má»«ng
      const congrats = document.getElementById('congrats');
      congrats.classList.remove('hidden');
    
      // Confetti Ä‘Æ¡n giáº£n
      confetti({
        particleCount: 150,
        spread: 80,
        origin: { y: 0.6 },
      });
    
      // PhÃ¡t Ã¢m thanh
      const audio = new Audio('success.mp3');
      audio.play();
    
      // áº¨n sau 2 giÃ¢y
      setTimeout(() => {
        congrats.classList.add('hidden');
      }, 2000);
    }
    
    

   
function hienDocLap() {
  const doclapElement = document.getElementById("doclap");
  const flyingImg = document.querySelector(".flying-doclap-img");

  if (doclapElement) {
    doclapElement.style.display = "block";
  }

  if (flyingImg) {
    flyingImg.style.display = "block";
  }
}
function anDocLap() {
  const doclapElement = document.getElementById("doclap");
  const flyingImg = document.querySelector(".flying-doclap-img");

  if (doclapElement) {
    doclapElement.style.display = "none";
  }

  if (flyingImg) {
    flyingImg.style.display = "none";
  }
}


// HÃ m phÃ¡t nháº¡c khi Ä‘áº¡t Ä‘á»§ 33 cÃ¢u Ä‘Ãºng
function playVictoryMusic() {
const audio = new Audio('./HaoKhiVietNam.mp3'); // Thay 'path_to_victory_music.mp3' báº±ng Ä‘Æ°á»ng dáº«n Ä‘áº¿n file nháº¡c cá»§a báº¡n
audio.play();
}
function stopAllEffects() {
  // Dá»«ng phÃ¡o hoa
  clearInterval(fireworkInterval); 
  cancelAnimationFrame(fireworkAnimationFrame);

  // áº¨n mÃ¡y bay
  const airplanes = document.querySelectorAll('.flying-object');
  airplanes.forEach(airplane => airplane.style.display = 'none');

  // áº¨n xe tÄƒng
  const tanks = document.querySelectorAll('.flying-tank');
  tanks.forEach(tank => tank.style.display = 'none');
  
  // áº¨n cÃ¡c hiá»‡u á»©ng khÃ¡c náº¿u cÃ³
  const fires = document.querySelectorAll('.fire');
  fires.forEach(fire => fire.style.display = 'none');
  
  // Dá»«ng táº¥t cáº£ cÃ¡c animation (náº¿u cÃ³)
  const allAnimations = document.querySelectorAll('*');
  allAnimations.forEach(element => {
    element.style.animation = 'none'; // Há»§y bá» animation
  });

  // Dá»«ng má»i hoáº¡t Ä‘á»™ng liÃªn quan Ä‘áº¿n confetti
  confetti.reset();
}



}

    


    

    function startConfetti(originX, originY) {
      confetti({
        particleCount: 50,
        angle: 90,
        spread: 50,
        startVelocity: 50,
        origin: { x: originX, y: originY },
        colors: ['#ff0000', '#ffaa00', '#ffff00']
      });
    }
    let fireworkInterval;
    let fireworkAnimationFrame;
    let fireworkFired = false;

    function checkTankCrossing() {
      const tanks = document.querySelectorAll('.flying-tank');
      const doclap = document.getElementById('doclap');
    
      tanks.forEach(tank => {
        const tankRect = tank.getBoundingClientRect();
        const doclapRect = doclap.getBoundingClientRect();
    
        if (
          tankRect.right >= doclapRect.left &&
          tankRect.left <= doclapRect.right &&
          !fireworkFired
        ) {
          fireworkFired = true;
          launchFireworksFromDoclap();
    
          setTimeout(() => {
            fireworkFired = false;
          }, 1000);
        }
      });
    }
    
    function launchFireworksFromDoclap() {
      const doclap = document.getElementById('doclap');
      const rect = doclap.getBoundingClientRect();
    
      // ğŸ† Báº¯n phÃ¡o hoa
      confetti({
        particleCount: 20,
        angle: 90,
        spread: 60,
        startVelocity: 50,
        origin: {
          x: (rect.left + rect.width / 2) / window.innerWidth,
          y: (rect.top + rect.height / 2) / window.innerHeight,
        },
        colors: ['#ff0000', '#ffff00', '#00ff00', '#00ccff'],
      });
    
      // âœ… Hiá»ƒn thá»‹ chá»¯ "TOÃ€N THáº®NG!"
      const message = document.getElementById("victoryMessage");
      message.classList.add("show");
    
      // â±ï¸ Sau 5 giÃ¢y thÃ¬ áº©n Ä‘i
      setTimeout(() => {
        message.classList.remove("show");
      }, 5000);
    }
    
    let isCreatingAirplanes = false; // Biáº¿n theo dÃµi viá»‡c táº¡o mÃ¡y bay

    function createAirplane(id = "airplane", count = 1) {
      if (correctAnswers !== 33 || isCreatingAirplanes) return;
    
      isCreatingAirplanes = true; // ÄÃ¡nh dáº¥u báº¯t Ä‘áº§u quÃ¡ trÃ¬nh táº¡o mÃ¡y bay
      
      // Táº¡o ngáº«u nhiÃªn sá»‘ lÆ°á»£ng mÃ¡y bay (3 hoáº·c 4 mÃ¡y bay)
      const randomCount = Math.floor(Math.random() * 2) + 3; // Sá»‘ mÃ¡y bay ngáº«u nhiÃªn tá»« 3 Ä‘áº¿n 4
    
      for (let i = 0; i < randomCount; i++) {
        const airplane = document.createElement("img");
        airplane.src = "./â€”Pngtreeâ€”jet fighter illustration_8476956.png";
        airplane.className = "flying-object";
        
        // Náº¿u count > 1, thÃªm sá»‘ thá»© tá»± vÃ o id, cÃ²n láº¡i giá»¯ nguyÃªn
        airplane.id = count > 1 ? `${id}-${i}` : id;
        
        // MÃ¡y bay sÃ¡t nhau náº¿u count > 1, cÃ²n láº¡i giá»¯ nguyÃªn top
        const topOffset = 20 - i * 1.2;
        airplane.style.top = `${topOffset}%`;
    
        // Vá»‹ trÃ­ ngáº«u nhiÃªn trÃªn trá»¥c x (giá»›i háº¡n trong pháº¡m vi cá»­a sá»•)
        const randomLeft = Math.floor(Math.random() * 100) - 50; // Táº¡o vá»‹ trÃ­ ngáº«u nhiÃªn tá»« -50% Ä‘áº¿n 50%
        airplane.style.left = `${randomLeft}%`;
        
        // Hiá»‡u á»©ng bay tá»« trÃ¡i sang pháº£i (kÃ©o dÃ i qua mÃ n hÃ¬nh)
        const randomAnimationDuration = Math.floor(Math.random() * 5) + 5; // Tá»« 5s Ä‘áº¿n 10s
        airplane.style.animation = `flyAcross ${randomAnimationDuration}s linear forwards`;
        airplane.style.animationDelay = `${i * 0.15}s`; // Delay nhá» Ä‘á»ƒ cÃ¡c mÃ¡y bay bay gáº§n nhau
    
        document.body.appendChild(airplane);
    
        // Báº¯t Ä‘áº§u phÃ¡o hoa cho tá»«ng chiáº¿c náº¿u muá»‘n
        setTimeout(() => launchFireworks(airplane), i * 150);
    
        // Sau khi mÃ¡y bay hoÃ n thÃ nh animation, xÃ³a mÃ¡y bay vÃ  táº¡o láº¡i nhÃ³m má»›i
        airplane.addEventListener("animationend", () => {
          airplane.remove(); // XÃ³a mÃ¡y bay Ä‘Ã£ bay háº¿t
        });
      }
    
      // Táº¡o nhÃ³m má»›i má»—i 3 giÃ¢y sau khi táº¥t cáº£ mÃ¡y bay Ä‘Ã£ bay háº¿t
      setTimeout(() => {
        isCreatingAirplanes = false; // ÄÃ¡nh dáº¥u káº¿t thÃºc quÃ¡ trÃ¬nh táº¡o mÃ¡y bay
        createAirplane(id, count); // Táº¡o láº¡i nhÃ³m mÃ¡y bay má»›i
      }, 3000); // Thá»i gian táº¡o nhÃ³m má»›i (sau khi mÃ¡y bay Ä‘Ã£ bay háº¿t)
    }
    
    // CSS cho hiá»‡u á»©ng `flyAcross`
   
    
  

  
  
  

// HÃ m táº¡o hiá»‡u á»©ng phÃ¡o hoa




function launchFireworks(airplane) {
  // Náº¿u Ä‘Ã£ cÃ³ hiá»‡u á»©ng phÃ¡o hoa Ä‘ang cháº¡y, dá»«ng láº¡i
  if (fireworkInterval) clearInterval(fireworkInterval);  // XÃ³a interval cÅ© náº¿u cÃ³
  if (fireworkAnimationFrame) cancelAnimationFrame(fireworkAnimationFrame);  // XÃ³a animation frame cÅ© náº¿u cÃ³

  // Táº¡o phÃ¡o hoa liÃªn tá»¥c vá»›i sá»‘ lÆ°á»£ng Ã­t
  fireworkInterval = setInterval(() => {
    const rect = airplane.getBoundingClientRect();
    confetti({
      particleCount: 200, // Sá»‘ lÆ°á»£ng háº¡t phÃ¡o hoa Ã­t
      angle: 180,
      spread: 30, // Giáº£m Ä‘á»™ lan tá»a Ä‘á»ƒ Ã­t phÃ¡o hoa hÆ¡n
      startVelocity: 20, // Giáº£m tá»‘c Ä‘á»™ phÃ¡o hoa
      origin: {
        x: (rect.left + rect.width / 2) / window.innerWidth,
        y: (rect.top + rect.height / 2) / window.innerHeight,
      }
    });

    // Táº¡o vÃ²ng láº·p phÃ¡o hoa cháº¡y liÃªn tá»¥c
    confetti({
      particleCount: 3, // Sá»‘ lÆ°á»£ng phÃ¡o hoa Ã­t
      angle: 60,
      spread: 45, // Giáº£m Ä‘á»™ lan tá»a Ä‘á»ƒ Ã­t phÃ¡o hoa hÆ¡n
      origin: { x: 0 },
    });
    confetti({
      particleCount: 3, // Sá»‘ lÆ°á»£ng phÃ¡o hoa Ã­t
      angle: 120,
      spread: 45, // Giáº£m Ä‘á»™ lan tá»a
      origin: { x: 1 },
    });
  }, 1000); // Äiá»u chá»‰nh khoáº£ng thá»i gian giá»¯a cÃ¡c láº§n báº¯n (má»—i giÃ¢y)
}


// Gá»i hÃ m táº¡o mÃ¡y bay liÃªn tá»¥c
setInterval(() => createAirplane('airplane_' + Date.now()), 7000);  // Má»—i 7 giÃ¢y táº¡o 1 mÃ¡y bay má»›i



// ğŸš“ Táº¡o xe tÄƒng liÃªn tá»¥c
// HÃ m khá»Ÿi táº¡o xe tÄƒng má»›i vÃ  thÃªm hiá»‡u á»©ng
function createTank(id) {
  // Kiá»ƒm tra náº¿u sá»‘ cÃ¢u tráº£ lá»i Ä‘Ãºng lÃ  33
  if (correctAnswers === 33) {
    const wrapper = document.createElement("div");
    wrapper.className = "tank-wrapper";
    wrapper.id = id;

    const tankImg = document.createElement("img");
    tankImg.src = "./xetang.png";
    tankImg.className = "flying-tank";

    const fire = document.createElement("div");
    fire.className = "fire";

    wrapper.appendChild(tankImg);
    wrapper.appendChild(fire);

    document.body.appendChild(wrapper);

    return wrapper;
  }
  // Náº¿u khÃ´ng Ä‘á»§ Ä‘iá»u kiá»‡n, khÃ´ng lÃ m gÃ¬
  return null;
}


// ğŸ¬ Báº¯t Ä‘áº§u táº¡o mÃ¡y bay & xe tÄƒng sau má»—i vÃ i giÃ¢y
setInterval(createAirplane, 7000); // Má»—i 7 giÃ¢y cÃ³ 1 mÃ¡y bay
setInterval(createTank, 9000);     // Má»—i 9 giÃ¢y cÃ³ 1 xe tÄƒng

    function stopFireworks() {
      const airplane = document.getElementById('airplane');
      airplane.style.display = 'none';
      confetti.reset();
    }

  });
</script>

<img src="./â€”Pngtreeâ€”jet fighter illustration_8476956.png" class="flying-object" id="airplane" style="display: none;" />
<div class="tank-wrapper" id="tank">
  <img src="" class="flying-tank" />
  <div class="fire"></div> <!-- Lá»­a Ä‘Ã£ Ä‘Æ°á»£c di chuyá»ƒn vÃ o Ä‘Ã¢y -->
</div>

<div class="doclap-wrapper" id="doclap">
  <img src="./Ä‘inhoclap.png" class="flying-doclap-img" />
  <div id="victoryMessage">TOÃ€N THáº®NG!</div>
</div>

</body>
</html>
